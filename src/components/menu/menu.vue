<template>
    <nav class="menu">
        <div class="main-logo">
            <router-link to="/">
                <svg width="170" height="52" viewBox="0 0 170 52" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1.61392" y="1.61392" width="166.772" height="47.8797" stroke="#F5F749"
                        stroke-width="3.22785" />
                    <path
                        d="M11.8086 27.5016V24.6503L22.2184 18.894V22.606L15.7627 26.0759L22.2184 29.5459V33.2579L11.8086 27.5016ZM34.9032 15.3165H38.7229L28.582 34.1456H24.7624L34.9032 15.3165ZM44.6231 34.4146C43.5651 34.4146 42.543 34.1545 41.5567 33.6345C40.5704 33.0965 39.7545 32.2985 39.1089 31.2405C38.4813 30.1825 38.1674 28.9093 38.1674 27.4209C38.1674 25.9146 38.4813 24.6413 39.1089 23.6013C39.7365 22.5432 40.5614 21.7542 41.5836 21.2342C42.6057 20.6962 43.6907 20.4272 44.8383 20.4272C46.3447 20.4272 47.6627 20.8845 48.7924 21.799V14.5095H52.5583V34.1456H48.7924V32.7468C47.7524 33.8586 46.3626 34.4146 44.6231 34.4146ZM45.5108 31.2943C46.4433 31.2943 47.2234 31.0074 47.851 30.4335C48.4786 29.8418 48.7924 29.0527 48.7924 28.0665V26.7753C48.7924 25.807 48.4697 25.0269 47.8241 24.4351C47.1965 23.8434 46.4164 23.5475 45.4839 23.5475C44.4438 23.5475 43.601 23.8882 42.9554 24.5696C42.3099 25.2511 41.9871 26.2015 41.9871 27.4209C41.9871 28.6403 42.3099 29.5907 42.9554 30.2722C43.6189 30.9536 44.4707 31.2943 45.5108 31.2943ZM54.7051 20.6962H58.7937L61.5105 28.0934L61.8602 30.4873H62.0216L62.3713 28.0934L65.088 20.6962H69.1766L64.0121 34.1456H59.8428L54.7051 20.6962ZM71.3344 20.6962H75.1003V22.1487C76.2121 21.0011 77.6556 20.4272 79.4309 20.4272C80.471 20.4272 81.4753 20.6962 82.4436 21.2342C83.412 21.7542 84.201 22.5432 84.8107 23.6013C85.4204 24.6413 85.7252 25.9146 85.7252 27.4209C85.7252 28.9272 85.4025 30.2094 84.7569 31.2674C84.1293 32.3075 83.2954 33.0965 82.2553 33.6345C81.2332 34.1545 80.1393 34.4146 78.9737 34.4146C78.2205 34.4146 77.5032 34.289 76.8218 34.038C76.1583 33.7869 75.5844 33.4552 75.1003 33.0427V39.5253H71.3344V20.6962ZM78.4357 31.2943C79.4578 31.2943 80.2917 30.9536 80.9373 30.2722C81.5828 29.5907 81.9056 28.6403 81.9056 27.4209C81.9056 26.2015 81.5739 25.2511 80.9104 24.5696C80.2648 23.8882 79.422 23.5475 78.3819 23.5475C77.4494 23.5475 76.6693 23.8434 76.0417 24.4351C75.4141 25.009 75.1003 25.789 75.1003 26.7753V28.0665C75.1003 29.0348 75.4141 29.8149 76.0417 30.4066C76.6873 30.9984 77.4853 31.2943 78.4357 31.2943ZM88.3563 20.6962H92.1221V22.3101C92.6063 21.7363 93.1622 21.279 93.7898 20.9383C94.4175 20.5976 95.1079 20.4272 95.861 20.4272C96.399 20.4272 96.8294 20.4989 97.1522 20.6424L96.668 23.6013L96.4797 23.7896C96.121 23.6999 95.8162 23.6551 95.5651 23.6551C94.8299 23.6551 94.1664 23.8613 93.5746 24.2737C92.9829 24.6862 92.4987 25.2869 92.1221 26.0759V34.1456H88.3563V20.6962ZM105.533 34.4146C104.134 34.4146 102.879 34.1097 101.767 33.5C100.656 32.8903 99.7859 32.0564 99.1582 30.9984C98.5306 29.9404 98.2168 28.7479 98.2168 27.4209C98.2168 26.0939 98.5306 24.9014 99.1582 23.8434C99.7859 22.7853 100.656 21.9515 101.767 21.3418C102.879 20.7321 104.134 20.4272 105.533 20.4272C106.95 20.4272 108.214 20.7321 109.326 21.3418C110.438 21.9515 111.307 22.7853 111.935 23.8434C112.563 24.9014 112.877 26.0939 112.877 27.4209C112.877 28.7479 112.563 29.9404 111.935 30.9984C111.307 32.0564 110.438 32.8903 109.326 33.5C108.214 34.1097 106.95 34.4146 105.533 34.4146ZM105.533 31.1598C106.573 31.1598 107.425 30.8281 108.089 30.1646C108.77 29.4831 109.111 28.5686 109.111 27.4209C109.111 26.2732 108.77 25.3676 108.089 24.7041C107.425 24.0227 106.573 23.682 105.533 23.682C104.493 23.682 103.641 24.0227 102.978 24.7041C102.314 25.3676 101.983 26.2732 101.983 27.4209C101.983 28.5686 102.314 29.4831 102.978 30.1646C103.641 30.8281 104.493 31.1598 105.533 31.1598ZM121.274 34.4146C120.216 34.4146 119.194 34.1545 118.208 33.6345C117.221 33.0965 116.405 32.2985 115.76 31.2405C115.132 30.1825 114.818 28.9093 114.818 27.4209C114.818 25.9146 115.132 24.6413 115.76 23.6013C116.387 22.5432 117.212 21.7542 118.234 21.2342C119.257 20.6962 120.342 20.4272 121.489 20.4272C122.996 20.4272 124.314 20.8845 125.443 21.799V14.5095H129.209V34.1456H125.443V32.7468C124.403 33.8586 123.013 34.4146 121.274 34.4146ZM122.162 31.2943C123.094 31.2943 123.874 31.0074 124.502 30.4335C125.13 29.8418 125.443 29.0527 125.443 28.0665V26.7753C125.443 25.807 125.121 25.0269 124.475 24.4351C123.847 23.8434 123.067 23.5475 122.135 23.5475C121.095 23.5475 120.252 23.8882 119.606 24.5696C118.961 25.2511 118.638 26.2015 118.638 27.4209C118.638 28.6403 118.961 29.5907 119.606 30.2722C120.27 30.9536 121.122 31.2943 122.162 31.2943ZM140.313 18.7057H131.894V15.3165H144.59V18.087L137.704 34.1456H133.616L140.313 18.7057ZM147.703 29.5459L154.159 26.0759L147.703 22.606V18.894L158.113 24.6503V27.5016L147.703 33.2579V29.5459Z"
                        fill="#F5F749" />
                </svg>
            </router-link>
        </div>
        <button class="menu-toggle" @click="toggleMenu">
            ☰
        </button>
        <ul ref="menuRef" :class="{ 'menu-items': true, 'active': isOpen }">
            <li><a @click="navigateAndClose('about-section')">{{ t('menu.about') }}</a></li>
            <li><a @click="navigateAndClose('projects')">{{ t('menu.projects') }}</a></li>
            <li><a @click="navigateAndClose('contact')">{{ t('menu.contact') }}</a></li>
            <li class="lng-container">
                <button @click="setLanguage('es')" class="lng-button" :class="{ active: language === 'es' }">
                    <div class="flag-icon">
                        <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_15_49)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 0H15.3214V16.0179H0V0Z"
                                    fill="#FFE800" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 8.00891H15.3214V16.0178H0V8.00891Z"
                                    fill="#00148E" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 12.0134H15.3214V16.0179H0V12.0134Z"
                                    fill="#DA0010" />
                            </g>
                            <defs>
                                <clipPath id="clip0_15_49">
                                    <rect width="15.3214" height="16.0179" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>
                    </div>
                    Esp
                </button>
                <button @click="setLanguage('en')" class="lng-button" :class="{ active: language === 'en' }">
                    <div class="flag-icon">
                        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_15_54)">
                                <path d="M0.696289 0H16.0177V16.0179H0.696289V0Z" fill="#012169" />
                                <path
                                    d="M16.0177 0V2.00223L10.332 8.00893L16.0177 13.8592V16.0179H14.0128L8.29715 10.1363L2.73117 16.0179H0.696289V13.8905L6.26228 8.04021L0.696289 2.31508V0H2.55162L8.29715 5.88156L13.8631 0H16.0177Z"
                                    fill="white" />
                                <path
                                    d="M6.20243 10.1363L6.5316 11.2L1.95312 16.0179H0.696289V15.924L6.20243 10.1363ZM9.91309 9.76088L11.529 10.0112L16.0177 14.61V16.0179L9.91309 9.76088ZM16.0177 0L10.2722 6.13184L10.1525 4.7553L14.6412 0H16.0177ZM0.696289 0.0312849L6.47175 5.94413L4.70619 5.69385L0.696289 1.53296V0.0312849Z"
                                    fill="#C8102E" />
                                <path
                                    d="M5.96303 0V16.0179H10.751V0H5.96303ZM0.696289 5.50614V10.5117H16.0177V5.50614H0.696289Z"
                                    fill="white" />
                                <path
                                    d="M0.696289 6.50725V9.5106H16.0177V6.50725H0.696289ZM6.92062 0V16.0179H9.79339V0H6.92062Z"
                                    fill="#C8102E" />
                            </g>
                            <defs>
                                <clipPath id="clip0_15_54">
                                    <rect width="15.3214" height="16.0179" fill="white"
                                        transform="translate(0.696289)" />
                                </clipPath>
                            </defs>
                        </svg>
                    </div>
                    Eng
                </button>
            </li>
        </ul>
    </nav>
</template>


<style lang="scss">
@use '@/styles/grid';
@use './menu';
</style>

<script setup>
import { ref, onMounted, onBeforeUnmount } from 'vue';
import { useRouter } from 'vue-router'
import useI18n from '@/lang/useLang';

const isOpen = ref(false);
const menuRef = ref(null);
const router = useRouter()

const toggleMenu = () => {
    isOpen.value = !isOpen.value;
};
const { t, setLanguage, language } = useI18n();

function navigateAndClose(id) {
    isOpen.value = false

    // Si no estamos en la raíz, redirigimos con query
    if (router.currentRoute.value.path !== '/') {
        router.push({ path: '/', query: { scrollTo: id } })
    } else {
        const el = document.getElementById(id)
        const offset = 120

        if (el) {
            const top = el.getBoundingClientRect().top + window.pageYOffset - offset
            window.scrollTo({ top, behavior: 'smooth' })
        }
    }
}

function handleClickOutside(event) {
    if (
        menuRef.value &&
        !menuRef.value.contains(event.target) &&
        !event.target.closest('button')
    ) {
        isOpen.value = false
    }
}

onMounted(() => {
    document.addEventListener('click', handleClickOutside)
})

onBeforeUnmount(() => {
    document.removeEventListener('click', handleClickOutside)
})
</script>